<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Image Recognition AR</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.10.0/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/mobilenet@2.1.0/dist/mobilenet.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            overflow: hidden;
        }
        
        #video {
            width: 100%;
            height: 100vh;
            object-fit: cover;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 1;
        }
        
        #canvas {
            position: fixed;
            top: 0;
            left: 0;
            z-index: 2;
            pointer-events: none;
        }
        
        #arModel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 200px;
            height: 200px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            border-radius: 20px;
            display: none;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 80px;
            z-index: 999;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5);
            border: 4px solid white;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        #arModel:hover {
            transform: translate(-50%, -50%) scale(1.1);
        }
        
        .status {
            position: fixed;
            top: 20px;
            left: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px;
            border-radius: 10px;
            z-index: 1000;
            text-align: center;
            font-weight: bold;
        }
        
        .instructions {
            position: fixed;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px;
            border-radius: 10px;
            z-index: 1000;
            text-align: center;
        }
        
        .recognition-box {
            position: fixed;
            border: 3px solid #00ff00;
            background: rgba(0, 255, 0, 0.2);
            z-index: 3;
            pointer-events: none;
            display: none;
        }
        
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <video id="video" autoplay playsinline></video>
    <canvas id="canvas"></canvas>
    
    <div id="arModel">🚗</div>
    
    <div class="recognition-box" id="recognitionBox"></div>
    
    <div class="status">
        <div id="statusText">AI Model yükleniyor...</div>
        <div id="recognitionText">Tanınan: -</div>
        <div id="versionText">Version: Yükleniyor...</div>
    </div>
    
    <div class="instructions">
        📱 Kamerayı bir yüze veya nesneye tutun! AI tanıyınca 3D model açılacak!
    </div>

    <script>
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const arModel = document.getElementById('arModel');
        const statusText = document.getElementById('statusText');
        const recognitionText = document.getElementById('recognitionText');
        const versionText = document.getElementById('versionText');
        const recognitionBox = document.getElementById('recognitionBox');
        
        let model = null;
        let isRecognizing = false;
        let clickCount = 0;
        
        const targetObjects = [
            'person', 'human', 'face', 'woman', 'man', 'girl', 'boy',
            'car', 'automobile', 'vehicle', 'truck', 'bus',
            'cat', 'dog', 'animal', 'bird', 'fish'
        ];
        
        const modelEmojis = {
            'person': '👤',
            'human': '👤',
            'face': '😊',
            'woman': '👩',
            'man': '👨',
            'girl': '👧',
            'boy': '👦',
            'car': '🚗',
            'automobile': '🚗',
            'vehicle': '🚗',
            'truck': '🚛',
            'bus': '🚌',
            'cat': '🐱',
            'dog': '🐕',
            'animal': '🐾',
            'bird': '🐦',
            'fish': '🐠'
        };
        
        // AI Model yükle
        async function loadModel() {
            try {
                statusText.textContent = 'AI Model yükleniyor...';
                model = await mobilenet.load();
                statusText.textContent = '✅ AI Model hazır! Kamerayı bir nesneye tutun';
                console.log('AI Model yüklendi');
            } catch (error) {
                statusText.textContent = `❌ AI Model hatası: ${error.message}`;
                console.error('AI Model hatası:', error);
            }
        }
        
        // Kamera başlat
        async function startCamera() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { 
                        facingMode: 'environment',
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    } 
                });
                
                video.srcObject = stream;
                
                video.addEventListener('loadedmetadata', () => {
                    canvas.width = video.videoWidth;
                    canvas.height = video.videoHeight;
                    console.log('Kamera başarıyla başlatıldı');
                });
                
            } catch (error) {
                statusText.textContent = `❌ Kamera hatası: ${error.message}`;
                console.error('Kamera hatası:', error);
            }
        }
        
        // Görsel tanıma
        async function recognizeImage() {
            if (!model || isRecognizing) return;
            
            isRecognizing = true;
            
            try {
                // Video frame'ini canvas'a çiz
                ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                
                // AI ile tanıma yap
                const predictions = await model.classify(canvas);
                console.log('AI Predictions:', predictions);
                
                // En yüksek skorlu tahmini al
                const topPrediction = predictions[0];
                
                if (topPrediction.probability > 0.7) { // %70'den fazla güven
                    const className = topPrediction.className.toLowerCase();
                    
                    // Hedef nesnelerden birini tanıdı mı?
                    const matchedObject = targetObjects.find(obj => 
                        className.includes(obj) || obj.includes(className)
                    );
                    
                    if (matchedObject) {
                        recognitionText.textContent = `Tanınan: ${matchedObject} (${(topPrediction.probability * 100).toFixed(1)}%)`;
                        
                        // 3D Model göster
                        const emoji = modelEmojis[matchedObject] || '🎯';
                        arModel.textContent = emoji;
                        arModel.style.display = 'flex';
                        
                        // Tanıma kutusu göster
                        recognitionBox.style.display = 'block';
                        recognitionBox.style.left = '50%';
                        recognitionBox.style.top = '50%';
                        recognitionBox.style.width = '200px';
                        recognitionBox.style.height = '200px';
                        recognitionBox.style.transform = 'translate(-50%, -50%)';
                        
                        console.log(`Nesne tanındı: ${matchedObject}`);
                    } else {
                        recognitionText.textContent = `Tanınan: ${topPrediction.className} (${(topPrediction.probability * 100).toFixed(1)}%)`;
                        arModel.style.display = 'none';
                        recognitionBox.style.display = 'none';
                    }
                } else {
                    recognitionText.textContent = 'Tanınan: - (Düşük güven)';
                    arModel.style.display = 'none';
                    recognitionBox.style.display = 'none';
                }
                
            } catch (error) {
                console.error('Tanıma hatası:', error);
            }
            
            isRecognizing = false;
        }
        
        // 3D Model tıklama
        arModel.addEventListener('click', () => {
            clickCount++;
            
            // Animasyon
            arModel.style.transform = 'translate(-50%, -50%) scale(1.3)';
            setTimeout(() => {
                arModel.style.transform = 'translate(-50%, -50%) scale(1)';
            }, 200);
            
            // Alert mesajı
            const messages = [
                '🎉 Nesne başarıyla tanındı!',
                '🚀 3D Model aktif!',
                '✨ AR deneyimi çalışıyor!',
                '🌟 Harika bir tanıma!',
                '💫 AI gücü!'
            ];
            
            const message = messages[clickCount % messages.length];
            alert(message);
            
            console.log(`3D Model tıklandı! Mesaj: ${message}`);
        });
        
        // Version bilgisini yükle
        fetch('version.json')
            .then(response => response.json())
            .then(data => {
                versionText.textContent = `Version: v${data.version} (${new Date(data.lastUpdate).toLocaleString('tr-TR')})`;
            })
            .catch(error => {
                versionText.textContent = 'Version: Hata';
            });
        
        // Sayfa yüklendiğinde
        window.addEventListener('load', async () => {
            await loadModel();
            setTimeout(startCamera, 1000);
            
            // Her 2 saniyede bir tanıma yap
            setInterval(recognizeImage, 2000);
        });
        
        // Sayfa kapanırken kamerayı durdur
        window.addEventListener('beforeunload', () => {
            if (video.srcObject) {
                video.srcObject.getTracks().forEach(track => track.stop());
            }
        });
    </script>
</body>
</html> 